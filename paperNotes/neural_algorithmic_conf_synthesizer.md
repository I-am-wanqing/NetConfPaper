使用神经网络算法配置计算机网络，比 SMT 方法 快 490 倍

**找出一个配置，在给定规则 S 下，实现最大化一致性 C**


# SMT 的方法

- satisfiability modulo theory (SMT) solvers
    
    - 缺点
        
        - “typically protocol-specific, hand-coded, and can exhibit discrepancies in behavior when compared to actual router hardware”
            
        - “very slow or fail to complete for large networks”
            
    - 例如：“NetComplete”  “SyNET”
        
- “Non-SMT-based tools”
    
    - 缺点
        
        - “at the cost of generality.”
            
    - 例如：“Zeppelin”  “Propane”
        

# 可扩展性问题

- “in a Tier-1 ISP, network operators modify their configurations up to 20 times per day, on average” 
    
- 前提：解决可扩展性障碍的一种方法是放宽配置综合问题，承认具有高效用的近似解决方案 —— 配置可能并不总是满足给定规范的所有要求，但可能几乎满足所有要求。对于网络运营商来说，这样的配置比没有任何自动化支持要好得多。
    

# 本文方法

- 路由协议可以被表述为Bellman-Ford风格的图算法
    
- NAR
    
- 模拟所涉及的协议并计算的转发状态来学习 从（规范，配置）对的数据集中进行合成
    
- 引入了一种通用的拓扑和配置嵌入方案，使我们的方法与协议无关
    
- 在网络配置生成过程中，给定一个规范，我们的模型预测网络配置的分布，从中我们可以采样可能的结果。
    

# 贡献

- 问题建模 - 放宽要求
    
- 提出了一种基于NAR的神经网络架构
    
- 评估 - 合成速度 、 满足规范的程度上
    

# 方法

- 转发平面定义 W配置 T拓扑
    

- 转发规范 S中的每个需求建模为一个转发规范
    

- 转发规范满足需求
    

- 需求：可达性、流量隔离或指定具体转发路径
    
- 优化目标 —— 最大化配置规范一致性
    

- 所有可能解
    

- 配置规范一致性
    

# 路由协议作为图算法

- 路由协议的底层计算可以理解为传统的消息传递图算法。因此，许多路由协议可以被表述为Bellman-Ford （BF）风格的传播过程。
    
- NAR建议用神经网络取代传统算法，以学习改进的算法程序或扩展现有算法以适用于原始数据
    

# 配置参数

- OSPF，按照已有的研究[15,16]来综合链路权重
    
    - “Netcomplete: Practical network-wide configuration synthesis with autocompletion.” 
        
    - “Netcomplete: Practical network-wide configuration synthesis with autocompletion.” 
        
- BGP，只综合BGP的“import policies” 
    
    - “Probabilistic verification of network configurations.” 
        

# 神经网络配置生成模型

- 模型输入
    
    - 拓扑
        
    - 规范
        
    - 配置草图
        
- 根据NAR范例，
    
    - 首先在潜在空间中对合成器输入进行编码。
        
    - 然后，应用了一个基于图注意机制[42]的迭代处理器网络。
        
    - 最后，利用解码器网络来预测省略的组态参数的值，从而合成一个组态。
        

# 训练数据

- 为了获得这样的数据集，我们使用统一生成过程对一些拓扑结构的随机网络配置进行采样。然后利用Prot对涉及的协议进行仿真，得到相应的转发平面。接下来，我们通过随机选择适用于计算转发平面的属性来提取规范。这给我们留下了一对规范和拓扑。
    
- 这个过程也可以调整为依赖于实际的路由器硬件来计算P rot的结果，从而精确地捕获现实世界的行为。
    
- 模拟协议
    

- 在训练期间，我们将合成设置中表示待合成配置参数的所有事实参数屏蔽为未知参数。作为监督信号，我们使用掩码值作为真值，并对相应参数解码器网络的输出分布施加负对数似然损失。
    
- 为了从未知参数的输出分布中采样值，我们采用了多镜头采样策略。我们只对未知参数子集的值进行采样，将它们插入输入事实库并再次运行合成器。重复，直到没有未知参数。这种多镜头策略允许模型在计算中纳入先前合成参数的具体值。在我们的评估中，我们将这种方法与一次采样所有参数进行比较。
    

# 评估

- “10, 240 samples” 
    
- 相应的规格和BGP/OSPF的配置请参见4.1。
    
- 关于BGP/OSPF数据集生成和训练的详细信息请参见附录A.3。
    

# 数据集生成详述



### A.3 数据集生成与训练

为了训练一个综合器模型，我们需要大量的事实库，这些事实库编码了各种网络拓扑、配置以及转发规范。此外，我们必须为模型提供未知参数的目标值，作为监督信号。本节将讨论我们如何构造这样的一个用于 BGP/OSPF 综合的数据集，并训练一个相应的综合模型。

#### 数据集生成

为了获得网络配置及相应的转发规范，我们采用以下生成过程：首先，为某些拓扑随机配置 BGP 和 OSPF 参数。然后，我们模拟 OSPF 和 BGP 协议，并计算结果转发平面。基于此，我们提取转发规范，该规范固定了一组随机的转发路径、可达性和隔离属性，这些属性在转发平面中得到满足。

#### 拓扑

在训练中，我们的数据集基于随机拓扑，这些拓扑包含 16-24 个路由器。我们通过在二维平面上 **均匀采样点的三角剖分** 来生成这些图的物理布局。

#### 仿真

为了在给定 OSPF 和 BGP 配置的情况下计算转发平面，我们模拟协议。对于 OSPF，我们实现了最短路径计算以获取转发平面。对于 BGP，我们实现了完整的 BGP 决策过程，如 ?? 所示（但不包括 MED 属性）。除了第 3 节中讨论的基本网络模型外，我们还实现了 eBGP 和 iBGP，以及完全网状 BGP 会话布局及依赖路由反射的布局。有关这些 BGP 概念的更多详细信息，请参见文献 [3]。

#### 事实库编码

我们使用一小组事实来对综合输入进行编码，并为每个事实库分配一个对应的事实库文件（参见图 7）。我们使用 `router`、`external` 和 `network` 等事实来标记路由器、外部对等点和路由目的地。路由器之间的物理链路被编码为 `connected(R1, R2, W)`，其中 W 表示 OSPF 链路权重。此外，我们依赖于 `ibgp`、`ebgp`、`route_reflector` 和 `bgp_route` 等事实来表示不同类型的 BGP 会话和导入路由。通过第 4.2 节中讨论的未知参数的概念，我们对配置参数（如导入路由的属性或 OSPF 链路权重）进行编码。

#### 规范语言

我们支持一个小型的规范语言，该语言包含以下三种转发谓词：

- `fwd(R1, Net, R2)`：指定路由器 R1 将目的地为 Net 的流量转发到邻居 R2。
    
- `reachable(R1, Net, R2)`：指定目的地为 Net 的流量在到达目的地之前通过 R1 和 R2。
    
- `trafficIsolation(R1, R2, N1, N2)`：指定以下条件中的只有一个可以为真：[fwd(R1, N1, R2)] 和 [fwd(R1, N2, R2)]。
    

在每个谓词的否定情况下，必须满足相反条件，事实才能被满足。可以通过在数据集生成过程中引入新的规范谓词来轻松扩展此规范语言。只需提供一种从转发平面提取正负案例的方法即可。一旦综合模型的训练数据集中包含了新的规范，最终的综合系统将能够考虑依赖于这些新类型谓词的规范。